**–°–º—ã—Å–ª** ‚Äî –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ *–∂–∏–≤–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ control-plane Kubernetes*, –∞ –∏–º–µ–Ω–Ω–æ **`kube-apiserver`**, –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫—É–¥–∞ —É—Ö–æ–¥–∏—Ç CPU-–≤—Ä–µ–º—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–º –∫–ª–∞—Å—Ç–µ—Ä–µ, —Å–æ–±—Ä–∞–Ω–Ω–æ–º —Ç–æ–±–æ–π –≤—Ä—É—á–Ω—É—é.

–¢–æ –µ—Å—Ç—å —Ç—ã —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å–¥–µ–ª–∞–ª **—Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π `kubectl flame` + `perf` –ø–∞–π–ø–ª–∞–π–Ω**, –Ω–æ –±–µ–∑ Helm, –±–µ–∑ Prometheus ‚Äî —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω–æ –∏ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ.

---

## üìÅ –ß—Ç–æ –≤ `labs/lab_level_2`

–¢–∞–º —Ü–µ–ø–æ—á–∫–∞ bash-—Å–∫—Ä–∏–ø—Ç–æ–≤, –∫–∞–∂–¥–∞—è ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø.

| –°–∫—Ä–∏–ø—Ç                    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                             | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                                                                                                                                                                                                                                                |
| :------------------------ | :--------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `01_debug_pod.sh`         | –°–æ–∑–¥–∞–Ω–∏–µ **debug-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞** —Å `hostPID`, `hostNetwork`, `privileged` | –î–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å "–≤–∏–¥–µ—Ç—å" –ø—Ä–æ—Ü–µ—Å—Å—ã —Ö–æ—Å—Ç–∞ –∏–∑–Ω—É—Ç—Ä–∏ pod‚Äô–∞ (–≤ —Ç–æ–º —á–∏—Å–ª–µ `kube-apiserver`) –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (`perf`, `strace`, `nsenter` –∏ —Ç.–¥.).                                                                                                                             |
| `01a_perf_runner.sh`      | –õ—ë–≥–∫–∏–π **perf-runner** –Ω–∞ `alpine`                                     | –ü–æ–¥–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π pod, –≥–¥–µ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `perf` –∏ `curl`. –û–Ω —Ç–æ–∂–µ `privileged` –∏ –≤–∏–¥–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–æ–¥—ã. –≠—Ç–æ —Ç–≤–æ—è –ø–ª–æ—â–∞–¥–∫–∞ –¥–ª—è –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è —è–¥—Ä–∞.                                                                                                                               |
| `02_profile_apiserver.sh` | –û—Å–Ω–æ–≤–Ω–æ–π **–ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤—â–∏–∫**                                             | <ul><li>–Ω–∞—Ö–æ–¥–∏—Ç PID `kube-apiserver` –Ω–∞ —Ö–æ—Å—Ç–µ;</li><li>–ø—Ä–æ–≤–µ—Ä—è–µ—Ç `kernel.perf_event_paranoid` –∏ `kptr_restrict`;</li><li>–∑–∞–ø—É—Å–∫–∞–µ—Ç `perf record -F 99 -g -p <PID> -- sleep 60`;</li><li>—Å–æ–±–∏—Ä–∞–µ—Ç 99 —Å—ç–º–ø–ª–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –≤ `/tmp/apiserver.perf.data`.</li></ul>                             |
| `03_flamegraph.sh`        | –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ **FlameGraph**                                              | <ul><li>—Å—Ç–∞–≤–∏—Ç `perl` + —Å–∫–∞—á–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã [Brendan Gregg FlameGraph](https://github.com/brendangregg/FlameGraph);</li><li>–ø—Ä–æ–≥–æ–Ω—è–µ—Ç `perf script` ‚Üí `stackcollapse-perf.pl` ‚Üí `flamegraph.pl`;</li><li>—Å–æ–∑–¥–∞—ë—Ç `/tmp/flame.svg` ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é —Å—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤.</li></ul> |
| `04_fetch_and_commit.sh`  | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –∏ —Ñ–∏–∫—Å–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞                          | <ul><li>–∫–æ–ø–∏—Ä—É–µ—Ç `flame.svg` —Å pod‚Äô–∞ (`kubectl cp`);</li><li>—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ —Å —Ç–∞–π–º—Å—Ç–µ–º–ø–æ–º;</li><li>`git add/commit/push` ‚Üí —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (`flame-20251007-....svg`).</li></ul>                                                                                                          |

---

## ‚öôÔ∏è –ß—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ

1. **–ú–∏–Ω–∏-–∫–ª–∞—Å—Ç–µ—Ä** (`start`-—Å–∫—Ä–∏–ø—Ç –∏–∑ `mini-k8s`) –ø–æ–¥–Ω—è–ª control-plane (etcd, apiserver, controller, scheduler) –∫–∞–∫ static pods —á–µ—Ä–µ–∑ kubelet.
2. **`perf-runner`** –≤–æ—à—ë–ª –≤ `hostPID`-–Ω–µ–π–º—Å–ø–µ–π—Å, –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–æ—Ü–µ—Å—Å—É `kube-apiserver` –∏ —Å–Ω—è–ª –≤—ã–±–æ—Ä–∫—É —Å—Ç–µ–∫–∞ (`perf_event_open`).
3. **–î–∞–Ω–Ω—ã–µ** `/tmp/apiserver.perf.data` (~50 KB) —Å–æ–¥–µ—Ä–∂–∞—Ç ~6000 —Å—ç–º–ø–ª–æ–≤ —Å—Ç–µ–∫–∞ –∑–∞ –º–∏–Ω—É—Ç—É.
4. **FlameGraph** –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª –∏—Ö: –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏ = —Ñ—É–Ω–∫—Ü–∏–∏; —à–∏—Ä–∏–Ω–∞ = –¥–æ–ª—è CPU-–≤—Ä–µ–º–µ–Ω–∏; –Ω–∏–∂–Ω–∏–π —Å–ª–æ–π ‚Äî ‚Äú–∫–æ—Ä–Ω–∏‚Äù –≤—ã–∑–æ–≤–æ–≤, –≤–µ—Ä—Ö–Ω–∏–π ‚Äî leaf-—Ñ—É–Ω–∫—Ü–∏–∏.
5. **Git-–ø–∞–π–ø–ª–∞–π–Ω** –≤—ã–≥—Ä—É–∑–∏–ª SVG –≤ —Ä–µ–ø–æ, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –≤–µ—Ä—Å–∏—é –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä—è–º–æ –≤–º–µ—Å—Ç–µ —Å –∫–æ–¥–æ–º (–∏–¥–µ—è ‚Äî ‚ÄúInfrastructure + Profiling as Code‚Äù).

---

## üî• –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç FlameGraph

–ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å `flame-20251007-‚Ä¶.svg` –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

* –®–∏—Ä–æ–∫–∏–µ –±–ª–æ–∫–∏ –≤–Ω–∏–∑—É ‚Äî ‚Äú–¥–æ–ª–≥–∏–µ‚Äù —Ñ—É–Ω–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `runtime.schedule`, `syscall.Syscall`, `k8s.io/apiserver/pkg/endpoints/handlers`).
* –ú–æ–∂–Ω–æ –∫–ª–∏–∫–∞—Ç—å, –∏—Å–∫–∞—Ç—å (`Ctrl+F`) ‚Äî —Å–º–æ—Ç—Ä–µ—Ç—å hot-spots: –Ω–∞–ø—Ä–∏–º–µ—Ä, `storage/etcd3`, `admission`, `authentication`, `serializer`, `runtime.gcBgMarkWorker`.
* –≠—Ç–æ —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å CPU-–Ω–∞–≥—Ä—É–∑–∫–∏ —Ç–≤–æ–µ–≥–æ API-—Å–µ—Ä–≤–µ—Ä–∞.

---

## üß† –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ

–¢—ã –ø–æ—Å—Ç—Ä–æ–∏–ª **–Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å–∏—Å—Ç–µ–º—É performance-–∞–Ω–∞–ª–∏–∑–∞ Kubernetes**, –ø—Ä–∏–≥–æ–¥–Ω—É—é –¥–ª—è:

* üß© –û—Ç–ª–∞–¥–∫–∏ control-plane –∏ CNI-—Å–µ—Ç–µ–π;
* ü©∫ –ò–∑–º–µ—Ä–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ (`etcd`, `scheduler`, `apiserver`);
* üìä –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏ performance (—Å–æ–±—Ä–∞–ª ‚Üí flamegraph ‚Üí –≤—ã–≥—Ä—É–∑–∏–ª ‚Üí commit);
* üî¨ –û—Å–≤–æ–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ `perf`, `eBPF`, –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è, *–∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω —è–¥—Ä–æ + kubelet + apiserver*.
